{
  "name": "ç®€åŒ–ç‰ˆæœ¬-20ä¸ªä¸´åºŠè¯•éªŒç»“æœæ”¶é›†",
  "nodes": [
    {
      "parameters": {},
      "name": "æ‰‹åŠ¨è§¦å‘æ”¶é›†",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "requestMethod": "GET",
        "url": "https://clinicaltrials.gov/api/query/study_fields",
        "options": {},
        "queryParametersUi": {
          "parameter": [
            {
              "name": "expr",
              "value": "AREA[StudyType]EXACT[\"Interventional\"] AND AREA[Phase]PHASE3 AND AREA[OverallStatus]EXACT[\"Completed\"] AND AREA[HasResults]EXACT[\"true\"]"
            },
            {
              "name": "fields", 
              "value": "NCTId,BriefTitle,Condition,InterventionName,PrimaryOutcomeMeasure,SecondaryOutcomeMeasure,CompletionDate,EnrollmentCount,HasResults,ResultsFirstPostDate"
            },
            {
              "name": "min_rnk",
              "value": "1"
            },
            {
              "name": "max_rnk", 
              "value": "50"
            },
            {
              "name": "fmt",
              "value": "json"
            }
          ]
        }
      },
      "name": "æœç´¢å·²å®Œæˆè¯•éªŒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "functionCode": "// ç­›é€‰å’Œæ¸…ç†å·²å®Œæˆçš„ä¸´åºŠè¯•éªŒæ•°æ®\nconst items = $input.all();\nconst processedData = [];\n\nfor (const item of items) {\n  const studies = item.json.StudyFieldsResponse?.StudyFields || [];\n  \n  for (const study of studies) {\n    // åªä¿ç•™æœ‰ç»“æœçš„å·²å®Œæˆè¯•éªŒ\n    if (study.HasResults && study.HasResults[0] === 'true') {\n      const processedStudy = {\n        nctId: study.NCTId?.[0] || '',\n        title: study.BriefTitle?.[0] || '',\n        condition: study.Condition?.join('; ') || '',\n        intervention: study.InterventionName?.join('; ') || '',\n        primaryOutcome: study.PrimaryOutcomeMeasure?.[0] || '',\n        secondaryOutcome: study.SecondaryOutcomeMeasure?.join('; ') || '',\n        completionDate: study.CompletionDate?.[0] || '',\n        enrollmentCount: parseInt(study.EnrollmentCount?.[0]) || 0,\n        resultsPostedDate: study.ResultsFirstPostDate?.[0] || '',\n        // ç”Ÿæˆç»“æœé¡µé¢é“¾æ¥\n        resultsUrl: `https://clinicaltrials.gov/study/${study.NCTId?.[0]}/results`,\n        // æ•°æ®è´¨é‡è¯„åˆ†\n        qualityScore: {\n          hasResults: !!study.HasResults?.[0],\n          hasPrimary: !!study.PrimaryOutcomeMeasure?.[0],\n          hasEnrollment: !!study.EnrollmentCount?.[0],\n          isLargeTrial: parseInt(study.EnrollmentCount?.[0] || 0) > 100\n        }\n      };\n      \n      processedData.push({ json: processedStudy });\n    }\n  }\n}\n\n// æŒ‰å…¥ç»„äººæ•°æ’åºï¼Œä¼˜å…ˆé€‰æ‹©å¤§æ ·æœ¬è¯•éªŒ\nprocessedData.sort((a, b) => b.json.enrollmentCount - a.json.enrollmentCount);\n\n// åªå–å‰20ä¸ª\nconst top20 = processedData.slice(0, 20);\n\n// è¾“å‡ºæ”¶é›†æ‘˜è¦\nconsole.log(`âœ… æˆåŠŸæ”¶é›† ${top20.length} ä¸ªä¸´åºŠè¯•éªŒæ•°æ®`);\nfor (let i = 0; i < Math.min(5, top20.length); i++) {\n  const trial = top20[i].json;\n  console.log(`${i+1}. ${trial.nctId}: ${trial.title} (${trial.enrollmentCount}äºº)`);\n}\n\nreturn top20;"
      },
      "name": "ç­›é€‰å‰20ä¸ªä¼˜è´¨è¯•éªŒ",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "requestMethod": "GET",
        "url": "https://clinicaltrials.gov/api/query/full_studies",
        "options": {},
        "queryParametersUi": {
          "parameter": [
            {
              "name": "expr",
              "value": "AREA[NCTId]={{$json.nctId}}"
            },
            {
              "name": "fmt",
              "value": "json"
            }
          ]
        }
      },
      "name": "è·å–è¯¦ç»†ç»“æœæ•°æ®",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "functionCode": "// æå–è¯¦ç»†çš„ç»“æœæ•°æ®å¹¶è¾“å‡ºåˆ°æ§åˆ¶å°\nconst items = $input.all();\nconst detailedResults = [];\n\nfor (const item of items) {\n  const study = item.json.FullStudiesResponse?.FullStudies?.[0]?.Study;\n  \n  if (study) {\n    const resultsSection = study.ResultsSection;\n    const protocolSection = study.ProtocolSection;\n    \n    const detailedResult = {\n      // åŸºæœ¬ä¿¡æ¯\n      nctId: protocolSection?.IdentificationModule?.NCTId || '',\n      title: protocolSection?.IdentificationModule?.BriefTitle || '',\n      \n      // ç ”ç©¶è®¾è®¡\n      studyType: protocolSection?.DesignModule?.StudyType || '',\n      phase: protocolSection?.DesignModule?.PhaseList?.Phase?.join(', ') || '',\n      allocation: protocolSection?.DesignModule?.DesignInfo?.DesignAllocation || '',\n      masking: protocolSection?.DesignModule?.DesignInfo?.DesignMasking || '',\n      \n      // å‚ä¸è€…ä¿¡æ¯\n      enrollmentCount: protocolSection?.DesignModule?.EnrollmentInfo?.EnrollmentCount || 0,\n      eligibilityCriteria: protocolSection?.EligibilityModule?.EligibilityCriteria || '',\n      \n      // å¹²é¢„æªæ–½\n      interventions: protocolSection?.ArmsInterventionsModule?.InterventionList?.Intervention?.map(i => ({\n        type: i.InterventionType,\n        name: i.InterventionName,\n        description: i.InterventionDescription\n      })) || [],\n      \n      // ä¸»è¦ç»“æœ\n      primaryOutcomes: protocolSection?.OutcomesModule?.PrimaryOutcomeList?.PrimaryOutcome?.map(o => ({\n        measure: o.PrimaryOutcomeMeasure,\n        timeFrame: o.PrimaryOutcomeTimeFrame,\n        description: o.PrimaryOutcomeDescription\n      })) || [],\n      \n      // ç»“æœæ•°æ® (è¿™æ˜¯å…³é”®éƒ¨åˆ†)\n      results: {\n        participantFlow: resultsSection?.ParticipantFlowModule,\n        baselineCharacteristics: resultsSection?.BaselineCharacteristicsModule,\n        outcomeData: resultsSection?.OutcomeMeasuresModule?.OutcomeMeasureList?.OutcomeMeasure?.map(outcome => ({\n          title: outcome.OutcomeMeasureTitle,\n          description: outcome.OutcomeMeasureDescription,\n          timeFrame: outcome.OutcomeMeasureTimeFrame,\n          type: outcome.OutcomeMeasureType,\n          // å…·ä½“æ•°å€¼ç»“æœ\n          results: outcome.OutcomeMeasureAnalysisList?.OutcomeMeasureAnalysis?.map(analysis => ({\n            groupDescription: analysis.OutcomeMeasureAnalysisGroupDescription,\n            statisticalMethod: analysis.OutcomeMeasureAnalysisStatisticalMethod,\n            pValue: analysis.OutcomeMeasureAnalysisPValue,\n            statisticalComment: analysis.OutcomeMeasureAnalysisStatisticalComment\n          })) || []\n        })) || [],\n        adverseEvents: resultsSection?.AdverseEventsModule\n      },\n      \n      // å…ƒæ•°æ®\n      lastUpdateDate: protocolSection?.StatusModule?.LastUpdatePostDate,\n      resultsFirstPosted: protocolSection?.StatusModule?.ResultsFirstPostDate,\n      collectedAt: new Date().toISOString()\n    };\n    \n    // è¾“å‡ºå…³é”®ç»“æœåˆ°æ§åˆ¶å°\n    console.log(`\\nğŸ“Š ${detailedResult.nctId}: ${detailedResult.title}`);\n    console.log(`ğŸ”¬ ç ”ç©¶ç±»å‹: ${detailedResult.studyType}, åˆ†æœŸ: ${detailedResult.phase}`);\n    console.log(`ğŸ‘¥ å…¥ç»„äººæ•°: ${detailedResult.enrollmentCount}`);\n    console.log(`ğŸ’Š å¹²é¢„æªæ–½: ${detailedResult.interventions.map(i => i.name).join(', ')}`);\n    console.log(`ğŸ¯ ä¸»è¦ç»ˆç‚¹: ${detailedResult.primaryOutcomes.map(o => o.measure).join(', ')}`);\n    console.log(`ğŸ“ˆ ç»“æœæ•°æ®: ${detailedResult.results.outcomeData?.length || 0} ä¸ªç»“æœæŒ‡æ ‡`);\n    \n    detailedResults.push({ json: detailedResult });\n  }\n}\n\nconsole.log(`\\nğŸ‰ æ•°æ®æ”¶é›†å®Œæˆï¼å…±æ”¶é›† ${detailedResults.length} ä¸ªè¯¦ç»†è¯•éªŒç»“æœ`);\nconsole.log(`ğŸ“Š æ•°æ®åŒ…å«: åŸºæœ¬ä¿¡æ¯ã€ç ”ç©¶è®¾è®¡ã€å¹²é¢„æªæ–½ã€ä¸»è¦ç»ˆç‚¹ã€ç»“æœæ•°æ®`);\nconsole.log(`ğŸ”— ä¸‹ä¸€æ­¥: ä½¿ç”¨LangChainæ„å»ºè§£æpipelineæå–ç–—æ•ˆæ•°æ®`);\n\nreturn detailedResults;"
      },
      "name": "æå–å¹¶æ˜¾ç¤ºç»“æœæ•°æ®",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1120, 300]
    }
  ],
  "connections": {
    "æ‰‹åŠ¨è§¦å‘æ”¶é›†": {
      "main": [
        [
          {
            "node": "æœç´¢å·²å®Œæˆè¯•éªŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æœç´¢å·²å®Œæˆè¯•éªŒ": {
      "main": [
        [
          {
            "node": "ç­›é€‰å‰20ä¸ªä¼˜è´¨è¯•éªŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç­›é€‰å‰20ä¸ªä¼˜è´¨è¯•éªŒ": {
      "main": [
        [
          {
            "node": "è·å–è¯¦ç»†ç»“æœæ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–è¯¦ç»†ç»“æœæ•°æ®": {
      "main": [
        [
          {
            "node": "æå–å¹¶æ˜¾ç¤ºç»“æœæ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "id": "simple-trial-collector"
} 